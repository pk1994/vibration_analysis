<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="HandheldFriendly" content="true" />
    <title>Speedometer Demo</title>

    <script src="https://cdn.zingchart.com/zingchart.min.js"></script>
    <script
      src="http://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"
      type="text/javascript"
    ></script>
    <link rel="stylesheet" type="text/css" href="app.css" />
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>

    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css"
    />
  </head>
  <body>
    <!-- Nav bar -->
    <div class="row" style="border-bottom: 1px solid #ccc">
      <div class="container">
        <div class="header-logo">
          <a href="index.html">
            <img class="company-logo" src="affine-logo.svg" />
          </a>
          <span class="heading">
            Vibration Analysis using Artificial Intelligence
          </span>
        </div>
      </div>
    </div>

    <!-- Audio Control -->
    <div class="col-md-12">
      <audio
        id="myaudio"
        controls
        class="col-md-3 audio"
        src="normal.wav"
      ></audio>

      <!-- spectogram image -->

      <div id="imgg" class="col-md-3 idimg"></div>

      <!-- amplitude image  -->

      <div id="imgg1" class="col-md-3 idimg1"></div>

      <!-- chart -->
    </div>
    <script>
      const url = "http://127.0.0.1:5005/testpost";
      imgdata = {};
      var click = 0;
      var soundfile = document.getElementById("myaudio");
      soundfile.onplaying = function() {
        const param = {
          headers: {
            "Content-Type": "application/json",
            Accept: "application/json"
          },
          body: soundfile.src,
          method: "POST"
        };
        console.log("body", param.body);
        fetch(url, param)
          .then(data => {
            return data.json();
          })
          .then(res => {
            console.log(res);
            imgdata = res;

            var newimg = document.createElement("img");
            newimg.className = "specimg";
            newimg.src = imgdata.data1;
            var imgdisp = document.getElementById("imgg");
            document.querySelectorAll(".specimg").forEach(function(a) {
              a.remove();
            });
            imgdisp.appendChild(newimg);

            // for showing Amplitude Image
            console.log("imgdata >>", imgdata.data2);
            var newimg1 = document.createElement("img");
            newimg1.className = "ampimg";
            newimg1.src = imgdata.data2;
            var imgdisp1 = document.getElementById("imgg1");
            document.querySelectorAll(".ampimg").forEach(function(a) {
              a.remove();
            });
            imgdisp1.appendChild(newimg1);
          });

        // for showing spectogram image
      };
    </script>
  </body>
</html>
